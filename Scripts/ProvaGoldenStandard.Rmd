---
title: "ProvaGoldStandard"
author: "Elisa Cangialosi"
date: "4/7/2019"
output: html_document
---

####Step 1: Introduction to the validation procedure
Four raters (2 males and 2 females) were selected to perform the labeling. The leader researcher organized a meeting with all the labelers and provided a validation procedure (to be included in an appendix) that includes the definition of each topic in the context of the study and some examples of them from real review/response available in the dataset.\ 
After the labelers read all the procedure, the researcher answered questions and provided clarification to them. After this stage, we requested them to label the first 10 pairs of the random subset. All labelers had the same random subset of review/response. Each labeler could assign as many topics as identified in the text of each pair. In case, the labelers believed that none of the 7 topics were discussed in the text he/she should label them as unclassifiable. The leading researcher also performed the validation but all labelers worked independently. When all the categorization was completed, each review was discussed individually to make sure that the topics were clear in labelers' mind and more explanation and/or clarification was provided by the researcher in case of disagreement. However, the original categorization was not modified even if after the discussion the labelers understood their mistakes. Before moving to the next step the research calculated the agreement between labelers including himself. {We establish two measure of agreement, full and partial. Full agreement is achieved when in each document all the topics are indentified by all 5 labelers. While partial agreement consist in keeping in each documents only those topics that are identified by all reviewers. Full agreement was 70%, partial was 100%.} So we proceeded to the next step.

```{r}
is.na(it_ReviewResponse) <- it_ReviewResponse == ' '
it_ReviewResponse <- it_ReviewResponse[!is.na(it_ReviewResponse$response),]

goldenSet <- it_ReviewResponse %>% select(-review_title, -stay_date, -review_score, -helpfulvote)
goldenSet$group <- gsub("([[:alpha:]]+)","",goldenSet$reviewID) #create a variable that identifies the review/response pairs
goldenSet2 <- goldenSet %>% arrange(group) # I order the dataset by the group, the objective is to select random group and run the validation of individual sentences as well as reviews of complete pairs of review response
goldenSet2$index <- c(1:length(goldenSet2$reviewID)) #I create a new column that uniquely identifies each sentence
x <- goldenSet2 %>% distinct(group) #create a vector with unique group number, I will randomly select group for my validation
set.seed(0500)
s10 <- sample(x$group,40)#random sample of 500 groups on which we will create our golden set
goldenSetlabel10 <- filter(goldenSet2,group %in%s10) # final dataset subject to manual labeling

goldenSetlabel10Final <- goldenSetlabel10 %>% 
  select(fullText, reviewID, index) %>% 
  bind_rows(
    goldenSetlabel10 %>% 
      transmute(fullText = response)
  )


write.csv(goldenSetlabel10Final, "/users/elisacangialosi/Desktop/LouisianaStateUniversity/IISemester/BookingReviews/ProjectR/GoldenStandardSet/Prova2/Gold10/goldStandard10.csv", row.names = TRUE ,na = " " )

```

####Step 2: Independent labeling (from 10 to 25 pairs) stage
In this step we moved from 10 to 50 pairs of review/response, individually rated by each labeler. In this subset, the labelers found sentences that were borderline between topic definition. {The subjective judment in those cases made the full agreement drop to 29% and the partial to 86%. This drop indicate the need to call a new meeting to clarify the borderline situations.}

```{r}
goldenSet <- it_ReviewResponse %>% select(-review_title, -stay_date, -review_score, -helpfulvote)
goldenSet$group <- gsub("([[:alpha:]]+)","",goldenSet$reviewID) #create a variable that identifies the review/response pairs
goldenSet2 <- goldenSet %>% arrange(group) # I order the dataset by the group, the objective is to select random group and run the validation of individual sentences as well as reviews of complete pairs of review response
goldenSet2$index <- c(1:length(goldenSet2$reviewID)) #I create a new column that uniquely identifies each sentence
x <- goldenSet2 %>% distinct(group) #create a vector with unique group number, I will randomly select group for my validation
set.seed(0800)
s50 <- sample(x$group,50)#random sample of 500 groups on which we will create our golden set
goldenSetlabel50 <- filter(goldenSet2,group %in%s50) # final dataset subject to manual labeling

goldenSetlabel50Final <- goldenSetlabel50 %>% 
  select(fullText, reviewID, index) %>% 
  bind_rows(
    goldenSetlabel50 %>% 
      transmute(fullText = response)
  )

goldStandard50 <- goldStandard50[sample(1:nrow(goldStandard50)), ]
View(goldStandard50)


write.csv(goldStandard50, "/users/elisacangialosi/Desktop/LouisianaStateUniversity/IISemester/BookingReviews/ProjectR/GoldenStandardSet/Prova2/Gold50/goldStandard50.csv", row.names = TRUE ,na = " " )
```

#Import 10goldstandard

```{r}
rater1_10$name <- "rater1"
rater2_10$name <- "rater2"
rater3_10$name <- "rater3"
rater4_10$name <- "rater4"
rater5_10$name <- "rater5"
```

#Rater 1

```{r}
#Location
rater1_10$loc_dummy <- ifelse(rater1_10$tema1 == "location" | rater1_10$tema2 == "location" | rater1_10$tema3 == "location" | rater1_10$tema4 == "location" | rater1_10$tema5 == "location" | rater1_10$tema6 == "location" | rater1_10$tema7 == "location" | rater1_10$tema8 == "location", 1, 0)
rater1_10$loc_dummy <- ifelse(is.na(rater1_10$loc_dummy), 0, 1)

#Servizio
rater1_10$ser_dummy <- ifelse(rater1_10$tema1 == "servizio" | rater1_10$tema2 == "servizio" | rater1_10$tema3 == "servizio" | rater1_10$tema4 == "servizio" | rater1_10$tema5 == "servizio" | rater1_10$tema6 == "servizio" | rater1_10$tema7 == "servizio" | rater1_10$tema8 == "servizio", 1, 0)
rater1_10$ser_dummy <- ifelse(is.na(rater1_10$ser_dummy), 0, 1)

#Saluti
rater1_10$greet_dummy <- ifelse(rater1_10$tema1 == "saluti" | rater1_10$tema2 == "saluti" | rater1_10$tema3 == "saluti" | rater1_10$tema4 == "saluti" | rater1_10$tema5 == "saluti" | rater1_10$tema6 == "saluti" | rater1_10$tema7 == "saluti" | rater1_10$tema8 == "saluti", 1, 0)
rater1_10$greet_dummy <- ifelse(is.na(rater1_10$greet_dummy), 0, 1)

#Stanza
rater1_10$room_dummy <- ifelse(rater1_10$tema1 == "stanza" | rater1_10$tema2 == "stanza" | rater1_10$tema3 == "stanza" | rater1_10$tema4 == "stanza" | rater1_10$tema5 == "stanza" | rater1_10$tema6 == "stanza" | rater1_10$tema7 == "stanza" | rater1_10$tema8 == "stanza", 1, 0)
rater1_10$room_dummy <- ifelse(is.na(rater1_10$room_dummy), 0, 1) 

#Servizi dell'hotel
rater1_10$amenit_dummy <- ifelse(rater1_10$tema1 == "servizi dell'hotel" | rater1_10$tema2 == "servizi dell'hotel" | rater1_10$tema3 == "servizi dell'hotel" | rater1_10$tema4 == "servizi dell'hotel" | rater1_10$tema5 == "servizi dell'hotel" | rater1_10$tema6 == "servizi dell'hotel" | rater1_10$tema7 == "servizi dell'hotel" | rater1_10$tema8 == "servizi dell'hotel", 1, 0)
rater1_10$amenit_dummy <- ifelse(is.na(rater1_10$amenit_dummy), 0, 1) 

#Cibo
rater1_10$food_dummy <- ifelse(rater1_10$tema1 == "cibo" | rater1_10$tema2 == "cibo" | rater1_10$tema3 == "cibo" | rater1_10$tema4 == "cibo" | rater1_10$tema5 == "cibo" | rater1_10$tema6 == "cibo" | rater1_10$tema7 == "cibo" | rater1_10$tema8 == "cibo", 1, 0)
rater1_10$food_dummy <- ifelse(is.na(rater1_10$food_dummy), 0, 1) 

#Valore
rater1_10$value_dummy <- ifelse(rater1_10$tema1 == "valore" | rater1_10$tema2 == "valore" | rater1_10$tema3 == "valore" | rater1_10$tema4 == "valore" | rater1_10$tema5 == "valore" | rater1_10$tema6 == "valore" | rater1_10$tema7 == "valore" | rater1_10$tema8 == "valore", 1, 0)
rater1_10$value_dummy <- ifelse(is.na(rater1_10$value_dummy), 0, 1)

#Inclassificabile
rater1_10$unclass_dummy <- ifelse(rater1_10$tema1 == "inclassificabile" | rater1_10$tema2 == "inclassificabile" | rater1_10$tema3 == "inclassificabile" | rater1_10$tema4 == "inclassificabile" | rater1_10$tema5 == "inclassificabile" | rater1_10$tema6 == "inclassificabile" | rater1_10$tema7 == "inclassificabile" | rater1_10$tema8 == "inclassificabile", 1, 0)
rater1_10$unclass_dummy <- ifelse(is.na(rater1_10$unclass_dummy), 0, 1)

rater1_10$id <- seq.int(nrow(rater1_10))
```

#Rater 2

```{r}
#Location
rater2_10$loc_dummy <- ifelse(rater2_10$tema1 == "location" | rater2_10$tema2 == "location" | rater2_10$tema3 == "location" | rater2_10$tema4 == "location" | rater2_10$tema5 == "location" | rater2_10$tema6 == "location" | rater2_10$tema7 == "location" | rater2_10$tema8 == "location", 1, 0)
rater2_10$loc_dummy <- ifelse(is.na(rater2_10$loc_dummy), 0, 1)

#Servizio
rater2_10$ser_dummy <- ifelse(rater2_10$tema1 == "servizio" | rater2_10$tema2 == "servizio" | rater2_10$tema3 == "servizio" | rater2_10$tema4 == "servizio" | rater2_10$tema5 == "servizio" | rater2_10$tema6 == "servizio" | rater2_10$tema7 == "servizio" | rater2_10$tema8 == "servizio", 1, 0)
rater2_10$ser_dummy <- ifelse(is.na(rater2_10$ser_dummy), 0, 1)

#Saluti
rater2_10$greet_dummy <- ifelse(rater2_10$tema1 == "saluti" | rater2_10$tema2 == "saluti" | rater2_10$tema3 == "saluti" | rater2_10$tema4 == "saluti" | rater2_10$tema5 == "saluti" | rater2_10$tema6 == "saluti" | rater2_10$tema7 == "saluti" | rater2_10$tema8 == "saluti", 1, 0)
rater2_10$greet_dummy <- ifelse(is.na(rater2_10$greet_dummy), 0, 1)

#Stanza
rater2_10$room_dummy <- ifelse(rater2_10$tema1 == "stanza" | rater2_10$tema2 == "stanza" | rater2_10$tema3 == "stanza" | rater2_10$tema4 == "stanza" | rater2_10$tema5 == "stanza" | rater2_10$tema6 == "stanza" | rater2_10$tema7 == "stanza" | rater2_10$tema8 == "stanza", 1, 0)
rater2_10$room_dummy <- ifelse(is.na(rater2_10$room_dummy), 0, 1) 

#Servizi dell'hotel
rater2_10$amenit_dummy <- ifelse(rater2_10$tema1 == "servizi dell'hotel" | rater2_10$tema2 == "servizi dell'hotel" | rater2_10$tema3 == "servizi dell'hotel" | rater2_10$tema4 == "servizi dell'hotel" | rater2_10$tema5 == "servizi dell'hotel" | rater2_10$tema6 == "servizi dell'hotel" | rater2_10$tema7 == "servizi dell'hotel" | rater2_10$tema8 == "servizi dell'hotel", 1, 0)
rater2_10$amenit_dummy <- ifelse(is.na(rater2_10$amenit_dummy), 0, 1) 

#Cibo
rater2_10$food_dummy <- ifelse(rater2_10$tema1 == "cibo" | rater2_10$tema2 == "cibo" | rater2_10$tema3 == "cibo" | rater2_10$tema4 == "cibo" | rater2_10$tema5 == "cibo" | rater2_10$tema6 == "cibo" | rater2_10$tema7 == "cibo" | rater2_10$tema8 == "cibo", 1, 0)
rater2_10$food_dummy <- ifelse(is.na(rater2_10$food_dummy), 0, 1) 

#Valore
rater2_10$value_dummy <- ifelse(rater2_10$tema1 == "valore" | rater2_10$tema2 == "valore" | rater2_10$tema3 == "valore" | rater2_10$tema4 == "valore" | rater2_10$tema5 == "valore" | rater2_10$tema6 == "valore" | rater2_10$tema7 == "valore" | rater2_10$tema8 == "valore", 1, 0)
rater2_10$value_dummy <- ifelse(is.na(rater2_10$value_dummy), 0, 1)

#Inclassificabile
rater2_10$unclass_dummy <- ifelse(rater2_10$tema1 == "inclassificabile" | rater2_10$tema2 == "inclassificabile" | rater2_10$tema3 == "inclassificabile" | rater2_10$tema4 == "inclassificabile" | rater2_10$tema5 == "inclassificabile" | rater2_10$tema6 == "inclassificabile" | rater2_10$tema7 == "inclassificabile" | rater2_10$tema8 == "inclassificabile", 1, 0)
rater2_10$unclass_dummy <- ifelse(is.na(rater2_10$unclass_dummy), 0, 1) 

rater2_10$id <- seq.int(nrow(rater2_10))
```

#Rater 3

```{r}
#Location
rater3_10$loc_dummy <- ifelse(rater3_10$tema1 == "location" | rater3_10$tema2 == "location" | rater3_10$tema3 == "location" | rater3_10$tema4 == "location" | rater3_10$tema5 == "location" | rater3_10$tema6 == "location" | rater3_10$tema7 == "location" | rater3_10$tema8 == "location", 1, 0)
rater3_10$loc_dummy <- ifelse(is.na(rater3_10$loc_dummy), 0, 1)

#Servizio
rater3_10$ser_dummy <- ifelse(rater3_10$tema1 == "servizio" | rater3_10$tema2 == "servizio" | rater3_10$tema3 == "servizio" | rater3_10$tema4 == "servizio" | rater3_10$tema5 == "servizio" | rater3_10$tema6 == "servizio" | rater3_10$tema7 == "servizio" | rater3_10$tema8 == "servizio", 1, 0)
rater3_10$ser_dummy <- ifelse(is.na(rater3_10$ser_dummy), 0, 1)

#Saluti
rater3_10$greet_dummy <- ifelse(rater3_10$tema1 == "saluti" | rater3_10$tema2 == "saluti" | rater3_10$tema3 == "saluti" | rater3_10$tema4 == "saluti" | rater3_10$tema5 == "saluti" | rater3_10$tema6 == "saluti" | rater3_10$tema7 == "saluti" | rater3_10$tema8 == "saluti", 1, 0)
rater3_10$greet_dummy <- ifelse(is.na(rater3_10$greet_dummy), 0, 1)

#Stanza
rater3_10$room_dummy <- ifelse(rater3_10$tema1 == "stanza" | rater3_10$tema2 == "stanza" | rater3_10$tema3 == "stanza" | rater3_10$tema4 == "stanza" | rater3_10$tema5 == "stanza" | rater3_10$tema6 == "stanza" | rater3_10$tema7 == "stanza" | rater3_10$tema8 == "stanza", 1, 0)
rater3_10$room_dummy <- ifelse(is.na(rater3_10$room_dummy), 0, 1) 

#Servizi dell'hotel
rater3_10$amenit_dummy <- ifelse(rater3_10$tema1 == "servizi dell'hotel" | rater3_10$tema2 == "servizi dell'hotel" | rater3_10$tema3 == "servizi dell'hotel" | rater3_10$tema4 == "servizi dell'hotel" | rater3_10$tema5 == "servizi dell'hotel" | rater3_10$tema6 == "servizi dell'hotel" | rater3_10$tema7 == "servizi dell'hotel" | rater3_10$tema8 == "servizi dell'hotel", 1, 0)
rater3_10$amenit_dummy <- ifelse(is.na(rater3_10$amenit_dummy), 0, 1)

#Cibo
rater3_10$food_dummy <- ifelse(rater3_10$tema1 == "cibo" | rater3_10$tema2 == "cibo" | rater3_10$tema3 == "cibo" | rater3_10$tema4 == "cibo" | rater3_10$tema5 == "cibo" | rater3_10$tema6 == "cibo" | rater3_10$tema7 == "cibo" | rater3_10$tema8 == "cibo", 1, 0)
rater3_10$food_dummy <- ifelse(is.na(rater3_10$food_dummy), 0, 1)

#Valore
rater3_10$value_dummy <- ifelse(rater3_10$tema1 == "valore" | rater3_10$tema2 == "valore" | rater3_10$tema3 == "valore" | rater3_10$tema4 == "valore" | rater3_10$tema5 == "valore" | rater3_10$tema6 == "valore" | rater3_10$tema7 == "valore" | rater3_10$tema8 == "valore", 1, 0)
rater3_10$value_dummy <- ifelse(is.na(rater3_10$value_dummy), 0, 1)

#Inclassificabile
rater3_10$unclass_dummy <- ifelse(rater3_10$tema1 == "inclassificabile" | rater3_10$tema2 == "inclassificabile" | rater3_10$tema3 == "inclassificabile" | rater3_10$tema4 == "inclassificabile" | rater3_10$tema5 == "inclassificabile" | rater3_10$tema6 == "inclassificabile" | rater3_10$tema7 == "inclassificabile" | rater3_10$tema8 == "inclassificabile", 1, 0)
rater3_10$unclass_dummy <- ifelse(is.na(rater3_10$unclass_dummy), 0, 1)

rater3_10$id <- seq.int(nrow(rater3_10))
```

#Rater 4

```{r}
#Location
rater4_10$loc_dummy <- ifelse(rater4_10$tema1 == "location" | rater4_10$tema2 == "location" | rater4_10$tema3 == "location" | rater4_10$tema4 == "location" | rater4_10$tema5 == "location" | rater4_10$tema6 == "location" | rater4_10$tema7 == "location" | rater4_10$tema8 == "location", 1, 0)
rater4_10$loc_dummy <- ifelse(is.na(rater4_10$loc_dummy), 0, 1)

#Servizio
rater4_10$ser_dummy <- ifelse(rater4_10$tema1 == "servizio" | rater4_10$tema2 == "servizio" | rater4_10$tema3 == "servizio" | rater4_10$tema4 == "servizio" | rater4_10$tema5 == "servizio" | rater4_10$tema6 == "servizio" | rater4_10$tema7 == "servizio" | rater4_10$tema8 == "servizio", 1, 0)
rater4_10$ser_dummy <- ifelse(is.na(rater4_10$ser_dummy), 0, 1)

#Saluti
rater4_10$greet_dummy <- ifelse(rater4_10$tema1 == "saluti" | rater4_10$tema2 == "saluti" | rater4_10$tema3 == "saluti" | rater4_10$tema4 == "saluti" | rater4_10$tema5 == "saluti" | rater4_10$tema6 == "saluti" | rater4_10$tema7 == "saluti" | rater4_10$tema8 == "saluti", 1, 0)
rater4_10$greet_dummy <- ifelse(is.na(rater4_10$greet_dummy), 0, 1)

#Stanza
rater4_10$room_dummy <- ifelse(rater4_10$tema1 == "stanza" | rater4_10$tema2 == "stanza" | rater4_10$tema3 == "stanza" | rater4_10$tema4 == "stanza" | rater4_10$tema5 == "stanza" | rater4_10$tema6 == "stanza" | rater4_10$tema7 == "stanza" | rater4_10$tema8 == "stanza", 1, 0)
rater4_10$room_dummy <- ifelse(is.na(rater4_10$room_dummy), 0, 1) 

#Servizi dell'hotel
rater4_10$amenit_dummy <- ifelse(rater4_10$tema1 == "servizi dell'hotel" | rater4_10$tema2 == "servizi dell'hotel" | rater4_10$tema3 == "servizi dell'hotel" | rater4_10$tema4 == "servizi dell'hotel" | rater4_10$tema5 == "servizi dell'hotel" | rater4_10$tema6 == "servizi dell'hotel" | rater4_10$tema7 == "servizi dell'hotel" | rater4_10$tema8 == "servizi dell'hotel", 1, 0)
rater4_10$amenit_dummy <- ifelse(is.na(rater4_10$amenit_dummy), 0, 1)

#Cibo
rater4_10$food_dummy <- ifelse(rater4_10$tema1 == "cibo" | rater4_10$tema2 == "cibo" | rater4_10$tema3 == "cibo" | rater4_10$tema4 == "cibo" | rater4_10$tema5 == "cibo" | rater4_10$tema6 == "cibo" | rater4_10$tema7 == "cibo" | rater4_10$tema8 == "cibo", 1, 0)
rater4_10$food_dummy <- ifelse(is.na(rater4_10$food_dummy), 0, 1)

#Valore
rater4_10$value_dummy <- ifelse(rater4_10$tema1 == "valore" | rater4_10$tema2 == "valore" | rater4_10$tema3 == "valore" | rater4_10$tema4 == "valore" | rater4_10$tema5 == "valore" | rater4_10$tema6 == "valore" | rater4_10$tema7 == "valore" | rater4_10$tema8 == "valore", 1, 0)
rater4_10$value_dummy <- ifelse(is.na(rater4_10$value_dummy), 0, 1)

#Inclassificabile
rater4_10$unclass_dummy <- ifelse(rater4_10$tema1 == "inclassificabile" | rater4_10$tema2 == "inclassificabile" | rater4_10$tema3 == "inclassificabile" | rater4_10$tema4 == "inclassificabile" | rater4_10$tema5 == "inclassificabile" | rater4_10$tema6 == "inclassificabile" | rater4_10$tema7 == "inclassificabile" | rater4_10$tema8 == "inclassificabile", 1, 0)
rater4_10$unclass_dummy <- ifelse(is.na(rater4_10$unclass_dummy), 0, 1)

rater4_10$id <- seq.int(nrow(rater4_10))
```

#Rater 5

```{r}
#Location
rater5_10$loc_dummy <- ifelse(rater5_10$tema1 == "location" | rater5_10$tema2 == "location" | rater5_10$tema3 == "location" | rater5_10$tema4 == "location" | rater5_10$tema5 == "location" | rater5_10$tema6 == "location" | rater5_10$tema7 == "location" | rater5_10$tema8 == "location", 1, 0)
rater5_10$loc_dummy <- ifelse(is.na(rater5_10$loc_dummy), 0, 1)

#Servizio
rater5_10$ser_dummy <- ifelse(rater5_10$tema1 == "servizio" | rater5_10$tema2 == "servizio" | rater5_10$tema3 == "servizio" | rater5_10$tema4 == "servizio" | rater5_10$tema5 == "servizio" | rater5_10$tema6 == "servizio" | rater5_10$tema7 == "servizio" | rater5_10$tema8 == "servizio", 1, 0)
rater5_10$ser_dummy <- ifelse(is.na(rater5_10$ser_dummy), 0, 1)

#Saluti
rater5_10$greet_dummy <- ifelse(rater5_10$tema1 == "saluti" | rater5_10$tema2 == "saluti" | rater5_10$tema3 == "saluti" | rater5_10$tema4 == "saluti" | rater5_10$tema5 == "saluti" | rater5_10$tema6 == "saluti" | rater5_10$tema7 == "saluti" | rater5_10$tema8 == "saluti", 1, 0)
rater5_10$greet_dummy <- ifelse(is.na(rater5_10$greet_dummy), 0, 1)

#Stanza
rater5_10$room_dummy <- ifelse(rater5_10$tema1 == "stanza" | rater5_10$tema2 == "stanza" | rater5_10$tema3 == "stanza" | rater5_10$tema4 == "stanza" | rater5_10$tema5 == "stanza" | rater5_10$tema6 == "stanza" | rater5_10$tema7 == "stanza" | rater5_10$tema8 == "stanza", 1, 0)
rater5_10$room_dummy <- ifelse(is.na(rater5_10$room_dummy), 0, 1) 

#Servizi dell'hotel
rater5_10$amenit_dummy <- ifelse(rater5_10$tema1 == "servizi dell'hotel" | rater5_10$tema2 == "servizi dell'hotel" | rater5_10$tema3 == "servizi dell'hotel" | rater5_10$tema4 == "servizi dell'hotel" | rater5_10$tema5 == "servizi dell'hotel" | rater5_10$tema6 == "servizi dell'hotel" | rater5_10$tema7 == "servizi dell'hotel" | rater5_10$tema8 == "servizi dell'hotel", 1, 0)
rater5_10$amenit_dummy <- ifelse(is.na(rater5_10$amenit_dummy), 0, 1)

#Cibo
rater5_10$food_dummy <- ifelse(rater5_10$tema1 == "cibo" | rater5_10$tema2 == "cibo" | rater5_10$tema3 == "cibo" | rater5_10$tema4 == "cibo" | rater5_10$tema5 == "cibo" | rater5_10$tema6 == "cibo" | rater5_10$tema7 == "cibo" | rater5_10$tema8 == "cibo", 1, 0)
rater5_10$food_dummy <- ifelse(is.na(rater5_10$food_dummy), 0, 1)

#Valore
rater5_10$value_dummy <- ifelse(rater5_10$tema1 == "valore" | rater5_10$tema2 == "valore" | rater5_10$tema3 == "valore" | rater5_10$tema4 == "valore" | rater5_10$tema5 == "valore" | rater5_10$tema6 == "valore" | rater5_10$tema7 == "valore" | rater5_10$tema8 == "valore", 1, 0)
rater5_10$value_dummy <- ifelse(is.na(rater5_10$value_dummy), 0, 1)

#Inclassificabile
rater5_10$unclass_dummy <- ifelse(rater5_10$tema1 == "inclassificabile" | rater5_10$tema2 == "inclassificabile" | rater5_10$tema3 == "inclassificabile" | rater5_10$tema4 == "inclassificabile" | rater5_10$tema5 == "inclassificabile" | rater5_10$tema6 == "inclassificabile" | rater5_10$tema7 == "inclassificabile" | rater5_10$tema8 == "inclassificabile", 1, 0)
rater5_10$unclass_dummy <- ifelse(is.na(rater5_10$unclass_dummy), 0, 1)

rater5_10$id <- seq.int(nrow(rater5_10))
```

#Join 

```{r}
install.packages('sqldf')
library(sqldf)
library(dplyr)

rater1_10clean <- rater1_10 %>% select(id, loc_dummy, ser_dummy, greet_dummy, room_dummy, amenit_dummy, food_dummy, value_dummy, unclass_dummy, name)
rater2_10clean <- rater2_10 %>% select(id, loc_dummy, ser_dummy, greet_dummy, room_dummy, amenit_dummy, food_dummy, value_dummy, unclass_dummy, name)
rater3_10clean <- rater3_10 %>% select(id, loc_dummy, ser_dummy, greet_dummy, room_dummy, amenit_dummy, food_dummy, value_dummy, unclass_dummy, name)
rater4_10clean <- rater4_10 %>% select(id, loc_dummy, ser_dummy, greet_dummy, room_dummy, amenit_dummy, food_dummy, value_dummy, unclass_dummy, name)
rater5_10clean <- rater5_10 %>% select(id, loc_dummy, ser_dummy, greet_dummy, room_dummy, amenit_dummy, food_dummy, value_dummy, unclass_dummy, name)


dummy_tot10 <- sqldf('select a.*, b.*, c.*, d.*, e.* from rater1_10clean a, rater2_10clean b, rater3_10clean c, rater4_10clean d, rater5_10clean e
where a.id == b.id == c.id == d.id == e.id')

#create totals
dummy_tot2_10 <- dummy_tot10 %>% group_by(id) %>%  mutate(tot_loc = sum(loc_dummy, loc_dummy..12, loc_dummy..22, loc_dummy..32, loc_dummy..42), tot_ser = sum(ser_dummy, ser_dummy..13, ser_dummy..23, ser_dummy..33, ser_dummy..43), tot_greet = sum(greet_dummy, greet_dummy..14, greet_dummy..24, greet_dummy..34, greet_dummy..44), tot_room = sum(room_dummy, room_dummy..15, room_dummy..25, room_dummy..35, room_dummy..45), tot_amenit = sum(amenit_dummy, amenit_dummy..16, amenit_dummy..26, amenit_dummy..36, amenit_dummy..46), tot_food = sum(food_dummy, food_dummy..17, food_dummy..27, food_dummy..37, food_dummy..47), tot_value = sum(value_dummy, value_dummy..18, value_dummy..28, value_dummy..38, value_dummy..48), tot_unclass = sum(unclass_dummy, unclass_dummy..19, unclass_dummy..29, unclass_dummy..39, unclass_dummy..49))

dummy_tot_clean10 <- dummy_tot2_10 %>% select(id, tot_loc, tot_ser, tot_greet, tot_room, tot_amenit, tot_food, tot_value, tot_unclass)

final10 <- data.frame(id = rep(c(1:20), each = 8), topic = rep(c('location', 'service', 'greetings and salutations', 'room', 'hotel amenities', 'food', 'value', 'unclassifiable'), 20))

final10$loc <- rep(dummy_tot2_10$tot_loc, each = 8)
final10$ser <- rep(dummy_tot2_10$tot_ser, each = 8)
final10$greet <- rep(dummy_tot2_10$tot_greet, each = 8)
final10$r <- rep(dummy_tot2_10$tot_room, each = 8)
final10$amenit <- rep(dummy_tot2_10$tot_amenit, each = 8)
final10$f <- rep(dummy_tot2_10$tot_food, each = 8)
final10$v <- rep(dummy_tot2_10$tot_value, each = 8)
final10$unclass <- rep(dummy_tot2_10$tot_unclass, each = 8)

final10$location <- ifelse(final10$topic == 'location', final10$loc, 0)
final10$service <- ifelse(final10$topic == 'service', final10$ser, 0)
final10$greetings <- ifelse(final10$topic == 'greetings and salutations', final10$greet, 0)
final10$room <- ifelse(final10$topic == 'room', final10$r, 0)
final10$hotel_amenities <- ifelse(final10$topic == 'hotel amenities', final10$amenit, 0)
final10$food <- ifelse(final10$topic == 'food', final10$f, 0)
final10$value <- ifelse(final10$topic == 'value', final10$v, 0)
final10$unclassifiable <- ifelse(final10$topic == 'unclassifiable', final10$unclass, 0)

```

#Fleiss Kappa

```{r}
finalFleissKappa10 <- final10 %>% select(id, topic, location, service, greetings, room, hotel_amenities, food, value)
finalFleissKappa10_2 <- finalFleissKappa10 %>% mutate(no_topic = (5 - (rowSums(finalFleissKappa10[,3:9]))))

ps<- finalFleissKappa10_2[,3:10] %>%  summarise_all(ps_func)
Pe <- sum(ps^2)#Pe fleiss kappa formula
p_func <- function(x) {
x <- x^2
y <- rowSums(x)
(y-5)/20
}
p <- p_func(finalFleissKappa10_2[,3:10]) #Ps for each row of the fleiss kappa
P <- sum(p)/length(finalFleissKappa10_2$id) #P average in the fleiss kappa
k1 <- (P-Pe)/(1-Pe)#fleiss kappa
```

